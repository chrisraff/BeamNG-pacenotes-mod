
<div class="pacenotes-editor" ng-init="onDocumentReady()">
    <style>
        .pacenotes-editor {
            color: white;
            font-weight: bold;
        }

        .pacenotes-editor button {
            color: black;
        }

        .pacenotes-editor .hide {
            display: none;
        }

        .pacenotes-editor summary {
            background-color: rgba(0, 0, 0, 0.5);
        }

        /* TODO switch to flexboxes so table height can be smarter */
        #pacenotes-list {
            height: 100px;
            resize: vertical;
            overflow-y: auto;
        }

        .pacenotes-editor table {
            width: 100%;
            border-collapse: collapse;
        }

        .pacenotes-editor th, .pacenotes-editor td {
            border: 1px solid white;
            padding: 8px;
            text-align: left;
            background-color: rgba(0, 0, 0, 0.2);
            font-size: 80%;
        }

        .pacenotes-editor th {
            background-color: rgba(0, 0, 0, 0.4);
        }

        .pacenotes-editor .selected-row {
            background-color: rgba(0.7, 0.7, 0.7, 0.6);
        }
    </style>

    <details open>
        <summary>Pacenotes</summary>

        <p>
            Rally ID: <span id="rally-id"></span>
        </p>
        <p>
            Mode:
            <span id="rally-mode"></span>
        </p>

        <details>
            <summary>Playback tuning</summary>
                <p>
                    Lookahead distance:
                    <input type="number" id="playback-lookahead" ng-model="playbackLookahead">
                </p>
                <p>
                    Speed Multiplier:
                    <input type="number" id="speed-multiplier" ng-model="speedMultiplier">
                </p>
        </details>

        <button id="connect-to-mic-server" ng-click="connectToMicServer()">Connect to Mic Server</button>
        <div id="recce-content" class="hide">
            <button id="recce-save" ng-click="setSaveRecce()">Save Recce</button>
            <button id="" ng-click="deleteLastPacenote()" class="hide">Delete Last Pacenote</button>

            <p>
                Number of Pacenotes: <span id="pacenotes-count"></span>
            </p>
        </div>

        <div ng-show="pacenotes_data != {}">
            <div id="pacenotes-list">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>D</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="pacenote in pacenotes_data" ng-click="selectRow($index)" ng-class="{'selected-row': $index === selectedRowIndex}">
                            <td>{{pacenote.name || pacenote.wave_name}}</td>
                            <td class="distance">{{pacenote.d}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <input type="checkbox" id="follow-note" ng-model="followNote">
            <label for="follow-note">Follow Current Note</label>
        </div>

        <div id="selected-row-details" ng-show="selectedRowIndex !== null">
            <label for="name">Name:</label>
            <input type="text" ng-model="pacenotes_data[selectedRowIndex].name" ng-model-options="{ updateOn: 'blur keydown', debounce: {'blur': 0, 'keydown': 500} }" placeholder="{{pacenotes_data[selectedRowIndex].wave_name }}">

            <label for="distance">Distance:</label>
            <input type="number" ng-model="pacenotes_data[selectedRowIndex].d" ng-model-options="{ updateOn: 'blur keydown', debounce: {'blur': 0, 'keydown': 500} }" >

            <button id="delete-pacenote" ng-click="deletePacenote()">Delete Pacenote</button>

            <button ng-click="saveRally()" ng-disabled="!isRallyChanged">Save Pacenotes</button>
        </div>

        <p>
            Distance: <span id="distance">{{distance.toFixed(2)}}</span>
            <button ng-click="jumpToDistance()">Jump To</button>
        </p>
    </details>

</div>
